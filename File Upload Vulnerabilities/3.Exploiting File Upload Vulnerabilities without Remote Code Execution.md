### Exploiting File Upload Vulnerabilities without Remote Code Execution

Even if you can't execute scripts on the server, file upload vulnerabilities can still be exploited in various other ways to compromise security. Here are two notable methods: client-side script attacks and exploiting vulnerabilities in file parsing.

#### 1. Uploading Malicious Client-Side Scripts

Even if server-side code execution is not possible, you might still exploit file upload functionality to execute scripts on the client side. This can be particularly dangerous if you can upload files like HTML or SVG, which can contain embedded scripts.

##### Example: Stored Cross-Site Scripting (XSS)

**Scenario**: A website allows users to upload profile pictures, but it does not properly validate the file types.

**Steps to Exploit**:
1. **Upload a Malicious File**:
   - Upload an HTML file (`malicious.html`) containing a script:
     ```html
     <html>
     <body>
       <script>
         alert('XSS Attack');
       </script>
     </body>
     </html>
     ```
2. **File Served to Users**:
   - If the website displays the uploaded file on a user profile page, any user visiting the profile page will have the script executed in their browser.
3. **Stored XSS**:
   - Since the script is stored on the server and served to clients, it creates a Stored XSS attack. For example, if the URL `http://example.com/uploads/malicious.html` is visited, the script executes.

##### Mitigation:
- Strictly validate and sanitize file uploads.
- Only allow certain file types (e.g., `.jpg`, `.png`), and verify file content.
- Serve uploaded files from a different domain or subdomain to avoid same-origin policy issues.

#### 2. Exploiting Vulnerabilities in File Parsing

When uploaded files are processed or parsed by the server, specific vulnerabilities in the parsing logic can be exploited.

##### Example: XML External Entity (XXE) Injection

**Scenario**: A website allows users to upload XML-based files (e.g., `.xml`, `.docx`, `.xlsx`) for processing.

**Steps to Exploit**:
1. **Create a Malicious XML File**:
   - Craft an XML file (`malicious.xml`) containing an XXE payload:
     ```xml
     <?xml version="1.0"?>
     <!DOCTYPE foo [
       <!ELEMENT foo ANY >
       <!ENTITY xxe SYSTEM "file:///etc/passwd" >]>
     <foo>&xxe;</foo>
     ```
2. **Upload the File**:
   - Upload `malicious.xml` to the website.
3. **File Processing**:
   - If the server parses the XML file without disabling external entity references, it will attempt to include the content of `/etc/passwd` in the XML structure.
4. **Data Exposure**:
   - The attacker may be able to retrieve sensitive data from the server.

##### Mitigation:
- Disable external entity references and DTDs in XML parsers.
- Validate and sanitize XML inputs.
- Use secure libraries and frameworks that handle XML parsing securely.

### Conclusion

Even without remote code execution, file upload vulnerabilities can still be leveraged for significant security breaches. By uploading malicious client-side scripts or exploiting file parsing vulnerabilities, attackers can achieve goals such as:

- Conducting Stored XSS attacks.
- Accessing sensitive server data via XXE attacks.

#### General Mitigations:
- Implement strict file validation and sanitization.
- Restrict allowable file types.
- Use secure methods and libraries for file processing.
- Regularly update and patch software to mitigate known vulnerabilities.

By understanding and mitigating these potential vectors, developers can better protect their applications from a wide range of file upload vulnerabilities.
